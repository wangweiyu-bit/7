<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å°äº’åŠ¨ Â· è€ç‹ç ”ç©¶æ‰€</title>
  <link rel="stylesheet" href="../assets/css/style.css" />
  <script defer src="../assets/js/main.js"></script>
</head>
<body>
  <div id="header"></div>
  <main class="container">
    <section>
      <h2 class="section-title">å°äº’åŠ¨ Â· Fun Zone <span class="cat-ears"></span></h2>
      <p class="muted">ä¸€äº›è½»æ¾çš„å°åŠŸèƒ½ï¼Œç¼“è§£ç§‘ç ”å‹åŠ›ï¼Œæå‡ä¸“æ³¨ä¸åŠ¨åŠ›ã€‚</p>

    </section>

    

    <section>
      <div class="grid fun-grid">
        <div class="col-4"><div class="card"><div class="card-body">
          <div class="row"><strong>ç§‘ç ”äººç¥ˆç¥·</strong><span class="tag">æ”¾æ¾å¿ƒæƒ…</span></div>
          <p class="card-desc">ç‚¹æˆ‘ç¥ˆç¥·ï¼Œç¥ä½ å®éªŒé¡ºåˆ©ã€æ•°æ®æ¼‚äº®ã€‚<span class="whiskers"></span></p>
          <div class="card-actions"><button class="btn primary" id="btn-prayer">å¼€å§‹ç¥ˆç¥· <span class="paw-print"></span></button></div>
        </div></div></div>

        <!-- å¿ƒæƒ…æµ‹è¯•ï¼šç§»åˆ°ç¬¬4ä½ -->
        <div class="col-4"><div class="card"><div class="card-body">
          <div class="row"><strong>ç§‘ç ”å¿ƒæƒ…æµ‹è¯•</strong><span class="tag">è½»æ¾ä¸€åˆ»</span></div>
          <p class="card-desc">3ä¸ªå°é—®é¢˜ï¼Œç”Ÿæˆä¸€æ¡è½»æ¾è¯„è¯­ã€‚</p>
          <div class="card-actions"><button class="btn" id="btn-mood">å¼€å§‹æµ‹è¯•</button></div>
        </div></div></div>

        <div class="col-4"><div class="card"><div class="card-body">
          <div class="row"><strong>æ•²æœ¨é±¼</strong><span class="tag">æ­£å¿µä¸€ä¸‹</span></div>
          <p class="card-desc">ç‚¹å‡»æœ¨é±¼ï¼Œé€ä½ ä¸€å¥ç§‘ç ”é¼“åŠ±ã€‚<span class="paw-print"></span></p>
          <div class="card-actions"><button class="btn" id="btn-wooden">æ•²ä¸€ä¸‹ <span class="paw-print"></span></button></div>
        </div></div></div>

        <div class="col-4"><div class="card"><img class="sticker-bg" src="../assets/img/water-sticker.png" alt="water sticker" onerror="this.style.display='none'"/><div class="card-body">
          <div class="row"><strong>å¤šå–æ°´</strong><span class="tag">å¥åº·æé†’</span></div>
          <p class="card-desc">è®©æ°´æ¯æ…¢æ…¢è£…æ»¡ï¼Œä¿æŒæ´»åŠ›ã€‚</p>
          <div class="row">
            <div class="water-cup" style="margin:8px 0">
              <div class="water-fill" id="water-fill"></div>
            </div>
          </div>
          <div class="card-actions"><button class="btn" id="btn-water">å–æ°´æ‰“å¡</button><button class="btn" id="btn-water-remind">è®¾ç½®æé†’</button></div>
        </div></div></div>

        <div class="col-4"><div class="card compact"><img class="sticker-bg" src="../assets/img/calm-sticker.png" alt="calm sticker" onerror="this.style.display='none'"/><div class="card-body">
          <div class="row"><strong>åˆ«ç”Ÿæ°”</strong><span class="tag">èˆ’ç¼“ä¸€ä¸‹</span></div>
          <p class="card-desc">é‡åˆ°å›°éš¾ç‚¹è¿™é‡Œï¼Œç»™ä½ ä¸€ç‚¹å®‰æ…°ä¸èƒ½é‡ã€‚</p>
          <div class="card-actions"><button class="btn" id="btn-calm">æˆ‘æœ‰ç‚¹ä¸Šç«</button></div>
        </div></div></div>

        <div class="col-4"><div class="card compact"><img class="sticker-bg" src="../assets/img/challenge-sticker.png" alt="challenge sticker" onerror="this.style.display='none'"/><div class="card-body">
          <div class="row"><strong>æ¯æ—¥æŒ‘æˆ˜</strong><span class="tag">+1%</span></div>
          <p class="card-desc">ä»Šå¤©çš„å°ç›®æ ‡ï¼šå®Œæˆä¸€ä¸ªå¯é‡åŒ–çš„å°è¿›æ­¥ã€‚</p>
          <div class="progress"><span id="challenge-progress"></span></div>
          <div class="card-actions"><button class="btn" id="btn-challenge">é¢†å–æŒ‘æˆ˜</button><button class="btn" id="btn-challenge-done">æˆ‘å®Œæˆäº†</button></div>
        </div></div></div>

        <!-- ä»Šæ—¥æŠ½ç­¾ï¼šæ•´è¡Œæ˜¾ç¤ºï¼Œå¡«æ»¡ç©ºç¼ºå½¢æˆè§„æ•´çŸ©å½¢ -->
        <div class="col-12"><div class="card"><div class="card-body">
          <div class="row"><strong>ä»Šæ—¥æŠ½ç­¾</strong><span class="tag">æ­£èƒ½é‡</span></div>
          <p class="card-desc">æŠ½ä¸€ç­¾ä»Šæ—¥çš„ç§‘ç ”å¥½è¿ä¸æŒ‡å¼•ï¼ˆä¸å®éªŒç›¸å…³çš„ç§¯æå¯„è¯­ï¼‰ã€‚</p>
          <div class="row"><button class="btn" id="btn-fortune">æŠ½ä¸€ç­¾ <span class="paw-print"></span></button><span id="fortune-text" class="muted"></span></div>
        </div></div></div>
      </div>

      <section>
        <h2 class="section-title">äº‘å…»çŒ« Â· å°çŒ«æ—¥å¸¸ <span class="cat-ears"></span> <small class="muted" style="font-weight:normal;margin-left:8px">æ¥åˆ°ä¸–ç•Œï¼š<span id="cat-age">è®¡ç®—ä¸­â€¦</span></small></h2>
        <p class="muted">çœ‹çœ‹ä¸¤åªçŒ«çŒ«çš„æ—¥å¸¸ï¼Œç‚¹â€œæ’¸ä¸€ä¸‹â€å¢åŠ çˆ±å¿ƒï¼›ä¹Ÿå¯æŠ•å–‚æ”¯æŒçŒ«ç²®ã€é›¶é£Ÿã€ç©å…·ã€‚</p>
        <div class="grid">
          <div class="col-4"><div class="card">
            <img src="../assets/img/cat1.jpg" alt="ä»Šæ—¥çŒ«çŒ«1" onerror="this.onerror=null;this.src='../assets/img/slide1.svg'" style="width:100%;border-radius:12px;border:1px solid var(--border)" />
            <div class="card-body">
              <div class="row"><strong>ä»Šæ—¥æ‰“ç›¹</strong><span class="tag">å¯çˆ±</span></div>
              <p class="card-desc">ä¸Šä¼ å›¾ç‰‡åˆ° assets/img/cat1.jpg æ›¿æ¢å ä½å›¾ã€‚</p>
              <div class="row" style="align-items:center;gap:8px">
                <button class="btn" id="btn-cat-like-1">æ’¸ä¸€ä¸‹ <span class="paw-print"></span></button>
                <span class="muted">çˆ±å¿ƒ <span id="cat-like-1">0</span></span>
              </div>
            </div>
          </div></div>
          <div class="col-4"><div class="card">
            <img src="../assets/img/cat2.jpg" alt="ä»Šæ—¥çŒ«çŒ«2" onerror="this.onerror=null;this.src='../assets/img/slide2.svg'" style="width:100%;border-radius:12px;border:1px solid var(--border)" />
            <div class="card-body">
              <div class="row"><strong>æ—¥å¸¸å·¡é€»</strong><span class="tag">æ´»æ³¼</span></div>
              <p class="card-desc">ä¸Šä¼ å›¾ç‰‡åˆ° assets/img/cat2.jpg æ›¿æ¢å ä½å›¾ã€‚</p>
              <div class="row" style="align-items:center;gap:8px">
                <button class="btn" id="btn-cat-like-2">æ’¸ä¸€ä¸‹ <span class="paw-print"></span></button>
                <span class="muted">çˆ±å¿ƒ <span id="cat-like-2">0</span></span>
              </div>
            </div>
          </div></div>
          <div class="col-4"><div class="card">
            <img src="../assets/img/cat3.jpg" alt="ä»Šæ—¥çŒ«çŒ«3" onerror="this.onerror=null;this.src='../assets/img/slide3.svg'" style="width:100%;border-radius:12px;border:1px solid var(--border)" />
            <div class="card-body">
              <div class="row"><strong>è®¤çœŸæ€è€ƒ</strong><span class="tag">æ²‰ç¨³</span></div>
              <p class="card-desc">ä¸Šä¼ å›¾ç‰‡åˆ° assets/img/cat3.jpg æ›¿æ¢å ä½å›¾ã€‚</p>
              <div class="row" style="align-items:center;gap:8px">
                <button class="btn" id="btn-cat-like-3">æ’¸ä¸€ä¸‹ <span class="paw-print"></span></button>
                <span class="muted">çˆ±å¿ƒ <span id="cat-like-3">0</span></span>
              </div>
            </div>
          </div></div>
        </div>
        <div class="space"></div>
        <div class="row">
          <button class="btn" data-feed="5">æŠ•å–‚å°é›¶é£Ÿ Â¥5</button>
          <button class="btn" data-feed="10">æŠ•å–‚çŒ«ç²® Â¥10</button>
          <button class="btn" data-feed="20">æŠ•å–‚ç©å…· Â¥20</button>
        </div>
        <div class="space"></div>
        <div class="card"><div class="card-body">
          <div class="row"><strong>æŠ•å–‚æ„Ÿè°¢å¢™</strong><span class="tag">è°¢è°¢å–µ</span></div>
          <form id="feed-form" class="row" style="gap:8px;margin-top:8px">
            <input id="feed-name" placeholder="ä½ çš„ç§°å‘¼(å¯é€‰)" style="max-width:200px" />
            <input id="feed-msg" placeholder="ç•™è¨€(å¯é€‰)" style="flex:1" />
            <button class="btn" type="submit">æäº¤</button>
          </form>
          <ul id="feed-list" class="muted" style="margin-top:8px;max-height:160px;overflow:auto;padding-right:6px"></ul>
        </div></div>
      </section>

      <!-- å°†ä»Šæ—¥æŠ½ç­¾åˆå…¥ä¸Šæ–¹ç½‘æ ¼ï¼šæ–°å¢ç¬¬7å¼ å¡ç‰‡ -->

      <section>
        <h2 class="section-title">ç§‘ç ”äº’åŠ¨åŒºï¼ˆåŒ¿åç‰ˆï¼‰</h2>
        <div class="card"><div class="card-body">
          <div class="row" id="anon-tabs" style="flex-wrap:wrap;gap:8px">
            <button class="btn" data-board="dating">ç›¸äº²è§’</button>
            <button class="btn" data-board="protocol">å®éªŒ Protocol</button>
            <button class="btn" data-board="jobs">æ±‚èŒ & æ‹›è˜</button>
            <button class="btn" data-board="rant">åæ§½ & åˆ†äº«</button>
            <button class="btn" data-board="trade">äºŒæ‰‹å›æ”¶</button>
            <button class="btn" data-board="exchange">ç»†èƒ/èµ„æºäº’æ¢</button>
          </div>
          <div class="space"></div>
          <form id="anon-form" class="grid" style="gap:12px">
            <div class="col-6"><input id="anon-title" placeholder="æ ‡é¢˜ï¼ˆå¯é€‰ï¼‰" /></div>
            <div class="col-6"><input id="anon-tags" placeholder="æ ‡ç­¾ï¼ˆé€—å·åˆ†éš”ï¼Œå¯é€‰ï¼‰" /></div>
            <div class="col-12"><textarea id="anon-content" rows="4" placeholder="å†…å®¹ï¼ˆæ”¯æŒçº¯æ–‡æœ¬ï¼Œæœ€å¤š 5000 å­—ï¼‰"></textarea></div>
            <div class="col-12"><div class="row" style="gap:8px;flex-wrap:wrap"><input type="file" id="anon-files" multiple accept="image/*,application/pdf,application/zip,application/x-zip-compressed,.7z,.rar,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.csv" style="max-width:420px" /><button class="btn" id="anon-upload" type="button">ä¸Šä¼ é™„ä»¶</button><span class="muted">å¯é€‰ï¼šæœ€å¤š 4 ä¸ªæ–‡ä»¶</span></div></div>
            <div class="col-12"><div class="row" style="gap:8px">
              <button class="btn primary" type="submit">åŒ¿åå‘å¸–</button>
              <input id="anon-q" placeholder="æœç´¢å…³é”®è¯" style="max-width:220px" />
              <button class="btn" id="anon-search" type="button">æœç´¢</button>
              <button class="btn" id="anon-today-match" type="button">ä»Šæ—¥ç¼˜åˆ†</button>
            </div></div>
          </form>
          <div class="space"></div>
          <div id="anon-list" class="grid" style="max-height:420px;overflow:auto;padding-right:6px"></div>
          <div class="space"></div>
          <div class="row" style="gap:8px;justify-content:flex-end"><button class="btn" id="anon-prev">ä¸Šä¸€é¡µ</button><span class="muted" id="anon-page-info"></span><button class="btn" id="anon-next">ä¸‹ä¸€é¡µ</button></div>
        </div></div>
      </section>

      <div class="modal" id="modal-generic">
        <div class="content">
          <div class="header"><strong id="modal-title">æç¤º</strong><button class="close" id="modal-close">âœ•</button></div>
          <div class="body" id="modal-body"></div>
        </div>
      </div>

      <div class="toast" id="toast"></div>
    </section>
  </main>
  <div id="footer"></div>

  <script>
    // Reuse the exact JS from index fun zone (already inlined there)
    document.addEventListener('DOMContentLoaded', () => {
      // --- åŒ¿åäº’åŠ¨åŒº ---
      (function(){
        const tabs = document.getElementById('anon-tabs');
        if(!tabs) return;
        const list = document.getElementById('anon-list');
        const form = document.getElementById('anon-form');
        const titleEl = document.getElementById('anon-title');
        const tagsEl = document.getElementById('anon-tags');
        const contentEl = document.getElementById('anon-content');
        const qEl = document.getElementById('anon-q');
        const btnSearch = document.getElementById('anon-search');
        const btnMatch = document.getElementById('anon-today-match');
        const btnPrev = document.getElementById('anon-prev');
        const btnNext = document.getElementById('anon-next');
        const pageInfo = document.getElementById('anon-page-info');
        let page = 1; const pageSize = 10; let total = 0;
        let uploadedMedia = [];
        let currentBoard = 'dating';

        function setActive(board){
          currentBoard = board;
          tabs.querySelectorAll('button').forEach(b=> b.classList.toggle('primary', b.getAttribute('data-board')===board));
          loadPosts();
        }

        tabs.querySelectorAll('button').forEach(b=> b.addEventListener('click', ()=> setActive(b.getAttribute('data-board'))));

        async function loadPosts(){
          try{
            // å¦‚æœæ²¡æœ‰åç«¯ï¼Œä½¿ç”¨æœ¬åœ°å­˜å‚¨æ¨¡æ‹Ÿï¼ˆä¸æ„Ÿè°¢å¢™ä¸€è‡´ï¼‰
            const storeKey = `anon:${currentBoard}`;
            let rows = [];
            try{
              const r = await LW.api.get(`/api/anon/posts?board=${encodeURIComponent(currentBoard)}&page=${page}&pageSize=${pageSize}`);
              if(r && Array.isArray(r.items)){
                rows = r.items; total = r.total||0;
              }else{ rows = []; total = 0; }
            }catch(_){ rows = []; }
            if(!Array.isArray(rows) || rows.length === 0){
              try{ rows = JSON.parse(localStorage.getItem(storeKey)||'[]'); }catch{ rows = []; }
              total = rows.length;
              // å®¢æˆ·ç«¯åˆ†é¡µ
              const start = (page-1)*pageSize; rows = rows.slice(start, start+pageSize);
            } else {
              // åŒæ­¥å¤‡ä»½åˆ°æœ¬åœ°ï¼Œä½œä¸ºç¦»çº¿/å›é€€
              try{ localStorage.setItem(storeKey, JSON.stringify(rows)); }catch(_){ }
            }
            const q = (qEl.value||'').trim();
            if(q){ rows = rows.filter(p => (p.title||'').includes(q) || (p.content||'').includes(q) || (p.tags||'').includes(q)); }
            renderList(rows||[]);
            if(pageInfo){ const totalPages = Math.max(1, Math.ceil(total / pageSize)); pageInfo.textContent = `ç¬¬ ${page}/${totalPages} é¡µ Â· å…± ${total} æ¡`; }
            if(btnPrev) btnPrev.disabled = page <= 1;
            if(btnNext) btnNext.disabled = (page * pageSize) >= total && total>0;
          }catch(e){ renderList([]); }
        }

        function escape(s){ return String(s||'').replace(/[&<>"']/g, ch=> ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[ch])); }
        function fmtTags(s){ const arr = String(s||'').split(',').map(t=>t.trim()).filter(Boolean); return arr.map(t=> `<span class="tag">${escape(t)}</span>`).join(' '); }

        function renderList(rows){
          if(!rows || rows.length===0){ list.innerHTML = '<div class="col-12"><div class="card"><div class="card-body"><p class="muted">æš‚æ— å†…å®¹ï¼Œæ¥å‘ç¬¬ä¸€æ¡å§ï½</p></div></div></div>'; return; }
          list.innerHTML = rows.map(p=> `
            <div class="col-12"><div class="card"><div class="card-body post-row">
              <div>
                <div class="row"><strong>${escape(p.title||'(æ— æ ‡é¢˜)')}</strong><span class="muted" style="font-size:12px">${new Date(p.created_at).toLocaleString()}</span></div>
                <p class="card-desc">${escape(String(p.content||'').slice(0,300))}${p.content && p.content.length>300?'â€¦':''}</p>
                <div class="row" style="flex-wrap:wrap;gap:8px">${fmtTags(p.tags)}</div>
                <div class="row" style="gap:8px">
                  <button class="btn" data-like="${p.id}">ç‚¹èµ ğŸ‘ <span>${p.likes_count||0}</span></button>
                  <button class="btn" data-cmt-toggle="${p.id}">è¯„è®º</button>
                </div>
                <div class="space"></div>
                <div class="hidden" id="cmt-box-${p.id}">
                  <div class="row" style="gap:8px;margin-bottom:8px"><input id="cmt-in-${p.id}" placeholder="å†™ä¸‹ä½ çš„æƒ³æ³•ï¼ˆåŒ¿åï¼‰" /><button class="btn" data-cmt="${p.id}">å‘é€</button></div>
                  <div id="cmt-list-${p.id}" class="muted"></div>
                </div>
              </div>
              <div>${renderMedia(p.media)}</div>
            </div></div></div>
          `).join('');

          // wire like
          list.querySelectorAll('[data-like]')?.forEach(btn=>{
            btn.addEventListener('click', async ()=>{
              const id = btn.getAttribute('data-like');
              try{
                const r = await LW.api.post(`/api/anon/posts/${id}/like`, {});
                const span = btn.querySelector('span'); if(span){ span.textContent = String(r && r.likes || 0); span.classList.add('like-pulse'); setTimeout(()=> span.classList.remove('like-pulse'), 360); }
                // æœ¬åœ°å­˜å‚¨åŒæ­¥ç‚¹èµæ•°
                const storeKey = `anon:${currentBoard}`;
                try{
                  const arr = JSON.parse(localStorage.getItem(storeKey)||'[]');
                  const it = arr.find(x=> String(x.id)===String(id)); if(it){ it.likes_count = (r && r.likes) || ((it.likes_count||0)+1); localStorage.setItem(storeKey, JSON.stringify(arr)); }
                }catch(_){ }
              }catch(_){
                // æ— åç«¯ï¼šæœ¬åœ°å¢åŠ 
                const span = btn.querySelector('span'); if(span){ span.textContent = String((parseInt(span.textContent||'0',10)||0)+1); span.classList.add('like-pulse'); setTimeout(()=> span.classList.remove('like-pulse'), 360); }
                const storeKey = `anon:${currentBoard}`;
                try{
                  const arr = JSON.parse(localStorage.getItem(storeKey)||'[]');
                  const it = arr.find(x=> String(x.id)===String(id)); if(it){ it.likes_count = (it.likes_count||0)+1; localStorage.setItem(storeKey, JSON.stringify(arr)); }
                }catch(__){ }
              }
            });
          });
          // wire comments toggle
          list.querySelectorAll('[data-cmt-toggle]')?.forEach(btn=>{
            btn.addEventListener('click', async ()=>{
              const id = btn.getAttribute('data-cmt-toggle');
              const box = document.getElementById(`cmt-box-${id}`);
              if(!box) return; box.classList.toggle('hidden');
              if(!box.classList.contains('hidden')){ await loadComments(id); }
            });
          });
          // wire send comment
          list.querySelectorAll('[data-cmt]')?.forEach(btn=>{
            btn.addEventListener('click', async ()=>{
              const id = btn.getAttribute('data-cmt');
              const inp = document.getElementById(`cmt-in-${id}`);
              const text = (inp && inp.value || '').trim();
              if(!text) return;
              try{
                await LW.api.post(`/api/anon/posts/${id}/comments`, { content: text });
                // ç«‹å³æ’å…¥åˆ°é¡µé¢ä¸‹æ–¹
                const listBox = document.getElementById(`cmt-list-${id}`);
                if(listBox){ const item = document.createElement('div'); item.innerHTML = `ğŸ’¬ ${escape(text)} Â· <small>${new Date().toLocaleString()}</small>`; listBox.prepend(item); }
                inp.value='';
                // æœ¬åœ°å¤‡ä»½è¯„è®ºæ•°
                const storeKey = `anon:${currentBoard}`;
                try{ const arr = JSON.parse(localStorage.getItem(storeKey)||'[]'); const it = arr.find(x=> String(x.id)===String(id)); if(it){ it.comments_count = (it.comments_count||0)+1; localStorage.setItem(storeKey, JSON.stringify(arr)); } }catch(_){ }
              }catch(_){
                // æ— åç«¯ï¼šç›´æ¥æ’å…¥åˆ°å±•ç¤º
                const listBox = document.getElementById(`cmt-list-${id}`);
                if(listBox){ const item = document.createElement('div'); item.innerHTML = `ğŸ’¬ ${escape(text)} Â· <small>${new Date().toLocaleString()}</small>`; listBox.prepend(item); }
                const storeKey = `anon:${currentBoard}`; try{ const arr = JSON.parse(localStorage.getItem(storeKey)||'[]'); const it = arr.find(x=> String(x.id)===String(id)); if(it){ it.comments_count = (it.comments_count||0)+1; localStorage.setItem(storeKey, JSON.stringify(arr)); } }catch(__){}
                inp.value='';
              }
            });
          });
        }

        async function loadComments(id){
          try{
            const rows = await LW.api.get(`/api/anon/posts/${id}/comments`);
            const box = document.getElementById(`cmt-list-${id}`);
            if(!box) return;
            box.innerHTML = (rows||[]).map(c=> `<div>ğŸ’¬ ${escape(c.content)} Â· <small>${new Date(c.created_at).toLocaleString()}</small></div>`).join('');
          }catch(_){ /* ignore */ }
        }

        function renderMedia(media){
          let arr = [];
          if(typeof media === 'string'){ try{ arr = JSON.parse(media||'[]')||[]; }catch{ arr = []; } }
          else if(Array.isArray(media)){ arr = media; }
          if(!arr || arr.length===0) return '';
          const items = arr.slice(0,4).map(u=>{
            const isImg = /\.(png|jpg|jpeg|gif|webp|bmp|svg)$/i.test(u) || u.startsWith('blob:');
            if(isImg){ return `<a href="${u}" target="_blank" rel="noreferrer"><img src="${u}" alt="img"/></a>`; }
            return `<a class="file" href="${u}" target="_blank" rel="noreferrer">ğŸ“ é™„ä»¶</a>`;
          }).join('');
          return `<div class="post-attachments">${items}</div>`;
        }

        form.addEventListener('submit', async (e)=>{
          e.preventDefault();
          const title = (titleEl.value||'').trim();
          const content = (contentEl.value||'').trim();
          const tags = (tagsEl.value||'').split(',').map(s=>s.trim()).filter(Boolean);
          // ä¼˜å…ˆä½¿ç”¨å·²ä¸Šä¼ çš„æœåŠ¡ç«¯ URLï¼Œå…¶æ¬¡ç”¨æœ¬åœ° blob ä½œä¸ºå ä½
          let media = uploadedMedia.slice(0,4);
          if(media.length === 0){
            const files = Array.from(document.getElementById('anon-files')?.files||[]);
            media = files.slice(0,4).map(f=> URL.createObjectURL(f));
          }
          if(!content){ toast('å†…å®¹ä¸èƒ½ä¸ºç©º'); return; }
          try{
            const payload = { board: currentBoard, title, content, tags, media };
            // ä¼˜å…ˆå°è¯•åç«¯
            try{ await LW.api.post('/api/anon/posts', payload); }catch(_){ /* ignore */ }
            // åŒæ­¥å†™å…¥æœ¬åœ°åˆ—è¡¨ï¼Œç«‹å³å¯è§
            const storeKey = `anon:${currentBoard}`;
            let arr = []; try{ arr = JSON.parse(localStorage.getItem(storeKey)||'[]'); }catch{ arr = []; }
            const now = new Date().toISOString();
            arr.unshift({ id: Date.now(), board: currentBoard, title, content, tags: tags.join(','), media, likes_count: 0, comments_count: 0, created_at: now });
            try{ localStorage.setItem(storeKey, JSON.stringify(arr.slice(0,200))); }catch(_){ }
            titleEl.value=''; contentEl.value=''; tagsEl.value=''; uploadedMedia = [];
            toast('å·²å‘å¸ƒï¼ˆåŒ¿åï¼‰');
            // ä¼˜å…ˆè¿½åŠ åˆ°åˆ—è¡¨é¡¶éƒ¨ï¼Œé¿å…ç­‰å¾…æ–°åŠ è½½
            await loadPosts();
          }catch(_){ toast('å‘å¸ƒå¤±è´¥'); }
        });
        btnPrev && btnPrev.addEventListener('click', ()=>{ if(page>1){ page--; loadPosts(); } });
        btnNext && btnNext.addEventListener('click', ()=>{ page++; loadPosts(); });

        // ä¸Šä¼ é™„ä»¶åˆ°åç«¯ï¼Œè¿”å› URL
        document.getElementById('anon-upload')?.addEventListener('click', async ()=>{
          const inp = document.getElementById('anon-files');
          const files = Array.from(inp?.files||[]).slice(0,4);
          if(files.length === 0){ toast('è¯·é€‰æ‹©æ–‡ä»¶'); return; }
          try{
            const fd = new FormData(); files.forEach(f=> fd.append('files', f));
            const res = await fetch('/api/upload', { method:'POST', body: fd });
            if(!res.ok) throw new Error('upload failed');
            const data = await res.json();
            uploadedMedia = (data && Array.isArray(data.files)) ? data.files.map(f=> f.url) : [];
            toast('ä¸Šä¼ æˆåŠŸ');
          }catch(e){ toast('ä¸Šä¼ å¤±è´¥'); }
        });
        btnSearch.addEventListener('click', loadPosts);
        btnMatch.addEventListener('click', async ()=>{
          // ç®€æ˜“â€œä»Šæ—¥ç¼˜åˆ†â€ï¼šä»ç›¸äº²è§’éšæœºå–ä¸€æ¡
          try{
            const rows = await LW.api.get('/api/anon/posts?board=dating');
            if(rows && rows.length){
              const one = rows[Math.floor(Math.random()*rows.length)];
              toast('ä»Šæ—¥ç¼˜åˆ†ï¼š' + (one.title || one.content.slice(0,16)+'â€¦'));
            }else{ toast('ä»Šå¤©ç¼˜åˆ†åœ¨è·¯ä¸Šâ€¦'); }
          }catch(_){ toast('ä»Šå¤©ç¼˜åˆ†åœ¨è·¯ä¸Šâ€¦'); }
        });

        // init
        setActive('dating');
      })();
      const toast = (t)=>{ const el = document.getElementById('toast'); el.textContent=t; el.classList.add('show'); setTimeout(()=>el.classList.remove('show'), 1800); };
      const showModal = (title, html)=>{ document.getElementById('modal-title').textContent=title; const b=document.getElementById('modal-body'); b.innerHTML=html; document.getElementById('modal-generic').classList.add('show'); };
      document.getElementById('modal-close').addEventListener('click', ()=> document.getElementById('modal-generic').classList.remove('show'));

      // ç¥ˆç¥·
      const prayerTexts = [
        'æ„¿ä½ çš„å®éªŒä»Šå¤©ä¸€æ¬¡è¿‡ï¼Œé‡å¤æ€§ä¼˜ç§€ï¼Œè¯¯å·®æå°ã€‚',
        'æ ·å“ç¨³ç¨³åœ¨çº¿ï¼Œä¿¡å·æ¸…æ™°å¦‚æ˜Ÿç©ºã€‚',
        'çµæ„Ÿæ‹‰æ»¡ï¼Œæ–¹æ³•çªç ´å°±åœ¨ä»Šå¤©ã€‚',
        'æ•°æ®åƒæºªæµä¸€æ ·è‡ªæ´½ï¼Œç»Ÿè®¡æ˜¾è‘—è€Œä¸”æ¼‚äº®ã€‚',
        'é‡åˆ°éš¾é¢˜ä¹Ÿæœ‰è€å¿ƒï¼Œæ…¢æ…¢æ¥ï¼Œä¸€åˆ‡åˆšå¥½ã€‚',
        'å…³é”®è¯•å‰‚ç¨³å®šå‘æŒ¥ï¼Œæœºå™¨çŠ¶æ€æ»¡æ ¼ã€‚',
        'å›¾ç‰ˆå¸ƒå±€é¡ºæ‰‹ï¼Œé…è‰²å’Œè°ï¼Œå®¡ç¨¿äººéƒ½ç‚¹å¤´ã€‚',
        'åˆä½œé¡ºåˆ©ï¼Œè®¨è®ºé«˜æ•ˆï¼Œæˆæœè‡ªç„¶æ±‡èšã€‚',
        'æ–‡çŒ®é‡Œæ°å¥½æœ‰çµæ„Ÿæ‹¼å›¾çš„ä¸€å—ã€‚',
        'å®éªŒè®°å½•è¯¦å°½æ¸…æ™°ï¼Œå¤ç°æ¯«ä¸è´¹åŠ›ã€‚',
        'é”™è¯¯æ—©æš´éœ²ï¼Œé—®é¢˜æ—©å‘ç°ï¼ŒèŠ‚çœå¤§æŠŠæ—¶é—´ã€‚',
        'æ¯ä¸ªå°æ­¥éª¤éƒ½æ¯”æ˜¨å¤©æ›´ç†Ÿç»ƒã€‚',
        'æ€è·¯æ›´æ¸…æ™°ä¸€æ­¥ï¼Œè´Ÿæ‹…æ›´è½»ä¸€ç‚¹ã€‚',
        'æ’æœŸåˆç†ï¼ŒèŠ‚å¥ç¨³å®šï¼Œä¸ç„¦è™‘ä¹Ÿæœ‰äº§å‡ºã€‚',
        'å®¡ç¨¿æ„è§åŒ–ä½œåŠ©åŠ›ï¼Œç‰ˆæœ¬è¶Šæ”¹è¶Šå¥½ã€‚',
        'å‰æœŸå‡†å¤‡æ‰å®ï¼Œä»Šå¤©æ”¶è·è¶…é¢„æœŸã€‚',
        'ä»£ç æ²¡æœ‰ bugï¼Œè¿è¡Œé€Ÿåº¦é£å¿«ã€‚',
        'è®ºæ–‡ç²¾è¯»ä¸€ç¯‡ï¼Œæ€è€ƒå¾—åˆ°ä¸¤ç‚¹æ–°è®¤è¯†ã€‚',
        'å›¢é˜Ÿäº’ç›¸æ”¯æŒï¼Œæ°›å›´æ¸©æš–ã€‚',
        'ä½ å·²ç»åœ¨è·¯ä¸Šï¼Œæœªæ¥ä¼šæ„Ÿè°¢ç°åœ¨çš„ä½ ã€‚'
      ];
      document.getElementById('btn-prayer').addEventListener('click', ()=>{
        const stars = Array.from({length:40}).map(()=>`<div class=\"star\" style=\"left:${Math.random()*100}% ; top:${Math.random()*100}% ; animation-delay:${(Math.random()*2).toFixed(2)}s\"></div>`).join('');
        const text = prayerTexts[Math.floor(Math.random()*prayerTexts.length)];
        const html = `<div style=\"position:relative\"> <div class=\"stars\">${stars}</div>
              <p>${text}</p>
              <audio id=\"bgm\" src=\"../assets/audio/prayer.mp3\" preload=\"none\"></audio>
              <div class=\"space\"></div><button class=\"btn\" id=\"play-bgm\">æ’­æ”¾éŸ³ä¹</button></div>`;
        showModal('ç§‘ç ”äººç¥ˆç¥·', html);
        setTimeout(()=>{ const a=document.getElementById('bgm'); const btn=document.getElementById('play-bgm'); btn && btn.addEventListener('click', ()=> a && a.play().catch(()=>toast('è¯·ç‚¹å‡»ä»¥æˆæƒæ’­æ”¾')) ); },0);
      });

      // æœ¨é±¼
      const woodenQuotes = [
        'å®éªŒè¿›å±•é¡ºåˆ©ï¼ç»§ç»­åŠ æ²¹ï¼','å†è¯•ä¸€æ¬¡ï¼Œæ•°æ®å°±æ¥äº†ï¼','ä½ å·²æ¯”æ˜¨å¤©æ›´è¿›ä¸€æ­¥','ç¨³ä½ï¼Œç¨³ä¸­æœ‰è¿›',
        'æ¯ä¸€ä¸ªå°å¤ç°ï¼Œéƒ½æ˜¯å¤§æˆæœçš„åŸºçŸ³ã€‚','è®°å½•è¶Šç»†ï¼Œå¤ç›˜è¶Šç¨³ã€‚','ä¿æŒå¥½å¥‡ï¼Œé—®é¢˜å°±ä¼šå¼€å£ã€‚',
        'å¤šäº†ä¸€æ¬¡å°è¯•ï¼Œå°±å¤šäº†ä¸€æ¬¡å¯èƒ½ã€‚','ä»Šå¤©ä¹Ÿè¦æ¸©æŸ”åœ°å¯¹å¾…è‡ªå·±ã€‚','æ•°æ®ä¸æ€¥ï¼Œæ…¢æ…¢æ‰“ç£¨ã€‚',
        'ä½ çš„æ–¹æ³•å¾ˆæ‰å®ï¼Œå€¼å¾—è¢«çœ‹è§ã€‚','æŒæ§å˜é‡ï¼Œä½ å°±æŒæ§ä¸»åŠ¨æƒã€‚','å›°éš¾åªæ˜¯å°šæœªæ‹†è§£çš„ç›®æ ‡ã€‚',
        'ä»åŸºç¡€åšèµ·ï¼Œæ•ˆç‡è‡ªç„¶æé«˜ã€‚','å­¦ä¼šå–èˆï¼Œä¸“æ³¨å…³é”®æŒ‡æ ‡ã€‚','æ¯ä¸€æ­¥éƒ½ç®—æ•°ã€‚',
        'æ¯”æ˜¨å¤©æ›´æ¸…æ¥šä¸€ç‚¹ï¼Œå°±æ˜¯èƒœåˆ©ã€‚','ä¿æŒèŠ‚å¥ï¼Œåˆ«è¢«æ€¥èºå¸¦èŠ‚å¥ã€‚','ä½ åšå¾—å¾ˆå¥½ã€‚','è¿‡ç¨‹æœ¬èº«å°±æ˜¯æˆé•¿ã€‚'
      ];
      const wooden = new Audio('../assets/audio/wooden.mp3');
      document.getElementById('btn-wooden').addEventListener('click', ()=>{ wooden.currentTime=0; wooden.play().catch(()=>{}); toast(woodenQuotes[Math.floor(Math.random()*woodenQuotes.length)]); });

      // å¤šå–æ°´
      const fill = document.getElementById('water-fill');
      const waterTips = [
        'è¡¥æ°´åˆ°ä½ï¼Œå¤´è„‘æ›´æ¸…é†’ã€‚','å–å£æ°´ï¼Œè®©ç»†èƒéƒ½å¼€å¿ƒã€‚','æ°´åˆ†è¶³ï¼Œæ•ˆç‡é«˜ã€‚','å°å£å¤šæ¬¡ï¼ŒçŠ¶æ€æ›´ç¨³ã€‚',
        'ä¿æŒæ°´æ¯åœ¨æ—è¾¹ï¼Œä¼šæ›´æƒ³å–æ°´ã€‚','å–æ°´æ˜¯å¯¹èº«ä½“çš„æ¸©æŸ”ç…§é¡¾ã€‚','ä¸€å£æ°´ï¼Œä¸€ç‚¹çµæ„Ÿã€‚',
        'æ°´åˆ°æ¸ æˆï¼Œäº‹åŠåŠŸå€ã€‚','è¡¥æ°´ä¹Ÿèƒ½å¢åŠ è€å¿ƒã€‚','å–æ°´ä¼‘æ¯ 30 ç§’ï¼Œå†ç»§ç»­ã€‚',
        'ä¿æ¸©æ¯çš„æ¸©åº¦åˆšåˆšå¥½ã€‚','å–æ°´ä¹Ÿç®—ç§‘å­¦çš„è‡ªæˆ‘ç®¡ç†ã€‚','æ°´æ¯è§åº•ï¼Œä»»åŠ¡è§å°¾ã€‚',
        'ä½ ç…§é¡¾èº«ä½“ï¼Œèº«ä½“ä¹Ÿä¼šå›é¦ˆä½ ã€‚','ä»Šå¤©ä¹Ÿè¦è¡¥æ°´æ‰“å¡ï¼','åˆ†æ®µè¡¥æ°´ï¼Œé¿å…ç–²åŠ³ã€‚',
        'å–å®Œè¿™å£ï¼Œå»å®Œæˆä¸€ä¸ªå°ç›®æ ‡ã€‚','ç»†èƒâ€œå¹²æ¯â€ï¼','æ°´æ¶¦ä¸‡ç‰©ï¼Œæ¶¦ä½ å¿ƒç”°ã€‚','å–æ°´ä»ç°åœ¨å¼€å§‹ã€‚'
      ];
      const waterProgress = document.createElement('span');
      waterProgress.className='muted';
      waterProgress.id='water-progress-text';
      fill.parentElement.parentElement.appendChild(waterProgress);
      function updateWaterText(h){ waterProgress.textContent = `ä»Šæ—¥è¡¥æ°´è¿›åº¦ï¼š${h}% Â· ${waterTips[Math.floor(Math.random()*waterTips.length)]}`; }
      document.getElementById('btn-water').addEventListener('click', ()=>{
        const h=Math.min(100,(parseInt(fill.style.height||'0')||0)+20);
        fill.style.height=h+'%';
        for(let i=0;i<4;i++){ const b=document.createElement('div'); b.className='water-bubble'; b.style.left=(10+Math.random()*100)+'px'; b.style.bottom='0'; b.style.animationDuration=(1.6+Math.random()*1.4)+'s'; fill.appendChild(b); setTimeout(()=>b.remove(),2400); }
        updateWaterText(h);
      });
      let remindTimer; document.getElementById('btn-water-remind').addEventListener('click', ()=>{ const mins=prompt('æ¯éš”å¤šå°‘åˆ†é’Ÿæé†’ä¸€æ¬¡ï¼Ÿ(5-120)','30'); const n=parseInt(mins,10); if(!n||n<5||n>120){ toast('å·²å–æ¶ˆ'); return;} if(remindTimer) clearInterval(remindTimer); remindTimer=setInterval(()=> toast('å–å£æ°´ï¼Œä¿æŒæ´»åŠ›ï¼'), n*60*1000); toast('æé†’å·²è®¾ç½®'); });

      // åˆ«ç”Ÿæ°”
      const calmTexts = [
        'ç§‘ç ”è·¯æ¼«æ¼«ï¼Œä¿æŒå†·é™ï¼Œæœªæ¥æ˜¯å…‰æ˜çš„ï¼','æ·±å‘¼å¸ï¼Œç¼“ä¸€ç¼“ï¼Œå†å‘å‰ã€‚','æš‚åœ 3 åˆ†é’Ÿï¼Œå–å£æ°´ï¼Œç»§ç»­ã€‚',
        'æŠŠé—®é¢˜æ‹†å°ä¸€ç‚¹ï¼Œä¸€æ¬¡è§£å†³ä¸€å—ã€‚','ä¸æ˜¯ä½ ä¸è¡Œï¼Œæ˜¯ä»»åŠ¡å¤ªå¤§äº†ï¼Œæ…¢æ…¢æ¥ã€‚','ä¼‘æ¯æ˜¯ä¸ºäº†èµ°æ›´è¿œçš„è·¯ã€‚',
        'å®¢è§‚çœ‹å¾…æ³¢åŠ¨ï¼Œä»Šå¤©ä¹Ÿè®¸åªæ˜¯å™ªå£°ã€‚','ä½ å·²ç»åšå¾—å¾ˆå¥½äº†ï¼Œåˆ«å¯¹è‡ªå·±å¤ªè‹›åˆ»ã€‚','æŠŠæ³¨æ„åŠ›æ”¾åœ¨èƒ½æŒæ§çš„å˜é‡ä¸Šã€‚',
        'å»æ•£ä¸ªæ­¥ï¼Œå›æ¥å°±æœ‰æ–°æ€è·¯ã€‚','æŠŠè¿›åº¦å†™ä¸‹æ¥ï¼Œä½ ä¼šçœ‹åˆ°è‡ªå·±çš„åŠªåŠ›ã€‚','å–„å¾…è‡ªå·±ï¼Œå–„å¾…æ•°æ®ã€‚',
        'æƒ…ç»ªä¼šè¿‡å»ï¼Œæˆæœä¼šç•™ä¸‹ã€‚','è¿™åªæ˜¯è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ã€‚','ä»Šå¤©çš„è€å¿ƒï¼Œå°±æ˜¯æ˜å¤©çš„ç»“æœã€‚',
        'ä½ ä¸æ˜¯ä¸€ä¸ªäººï¼Œæˆ‘ä»¬éƒ½åœ¨åŒä¸€æ¡ç§‘ç ”è·¯ä¸Šã€‚','è¯·ç»™è‡ªå·±ä¸€ç‚¹æ—¶é—´ã€‚','ä½ å€¼å¾—è¢«è‚¯å®šã€‚',
        'æ”¾è¿‡è‡ªå·±ï¼Œæ”¾è¿‡æ•°æ®ã€‚','æ…¢ä¸€ç‚¹ï¼Œåè€Œä¼šæ›´å¿«ã€‚'
      ];
      document.getElementById('btn-calm').addEventListener('click', ()=>{
        const t = calmTexts[Math.floor(Math.random()*calmTexts.length)];
        const html=`<p>${t}</p><div class=\"space\"></div><img src=\"../assets/img/slide2.svg\" alt=\"calm\" style=\"border-radius:12px;border:1px solid var(--border)\"/><div class=\"space\"></div><audio id=\"calm-a\" src=\"../assets/audio/calm.mp3\" preload=\"none\"></audio><button class=\"btn\" id=\"calm-play\">æ’­æ”¾èˆ’ç¼“éŸ³æ•ˆ</button>`;
        showModal('åˆ«ç”Ÿæ°”', html);
        setTimeout(()=>{ const a=document.getElementById('calm-a'); const b=document.getElementById('calm-play'); b && b.addEventListener('click', ()=> a && a.play().catch(()=>toast('è¯·ç‚¹å‡»ä»¥æˆæƒæ’­æ”¾')) ); },0);
      });

      // æ¯æ—¥æŒ‘æˆ˜
      const prog=document.getElementById('challenge-progress'); const saved=parseInt(localStorage.getItem('challenge:progress')||'0',10); prog.style.width=Math.min(100,saved)+'%';
      const challengeTasks = [
        'å®Œæˆä¸€æ¬¡ç»†èƒè®¡æ•°','æ•´ç†ä¸€å¼ å›¾ç‰ˆ','å¤ç°å®éªŒæ­¥éª¤å¹¶è®°å½•','å¤æ ¸ä¸€ç»„ç»Ÿè®¡','æ¸…ç†æ•°æ®ç¼ºå¤±é¡¹',
        'é‡è·‘ä¸€æ¬¡å…³é”®ä»£ç å¹¶åŠ ä¸Šæ–­è¨€','è¡¥é½ä¸€æ®µæ–¹æ³•å­¦è¯´æ˜','ç”»å‡ºä¸€å¼ æµç¨‹å›¾','è¡¥æ‹ä¸€å¼ ä»ªå™¨æ“ä½œç…§ç‰‡','å®Œå–„ä¸€æ¬¡å®éªŒè®°å½•',
        'å¤æŸ¥ 10 è¡Œæ•°æ®çš„æ¥æº','åˆ— 3 ä¸ªå¯èƒ½çš„è¯¯å·®æ¥æº','æŠŠæ ¸å¿ƒå›¾è¡¨å¯¼å‡ºé«˜åˆ†è¾¨ç‡ç‰ˆæœ¬','æŠŠä¸€ä¸ªé—®é¢˜å‘ç»™å¯¼å¸ˆ/åŒä¼´','ç»˜åˆ¶ä¸€å¼ å®éªŒç¤ºæ„è‰å›¾',
        'ä¼˜åŒ–ä¸€ä¸ªå‚æ•°å¹¶è®°å½•å½±å“','å†™ 3 å¥è¯æ€»ç»“ä»Šæ—¥è¿›å±•','ç»™æœªæ¥çš„è‡ªå·±ç•™ä¸€å¥æé†’','æ‰“åŒ…å¤‡ä»½ä¸€æ¬¡æ•°æ®','ç»™ä»“åº“å†™ä¸€ä¸ª README å°èŠ‚'
      ];
      document.getElementById('btn-challenge').addEventListener('click', ()=>{ toast('ä»Šæ—¥æŒ‘æˆ˜ï¼š'+challengeTasks[Math.floor(Math.random()*challengeTasks.length)]); });
      document.getElementById('btn-challenge-done').addEventListener('click', ()=>{ const w=Math.min(100,(parseInt(prog.style.width)||0)+20); prog.style.width=w+'%'; localStorage.setItem('challenge:progress', String(w)); toast(w>=100?'æŒ‘æˆ˜å®Œæˆï¼ğŸ‘':'è¿›åº¦ +20%'); });

      // å¿ƒæƒ…æµ‹è¯•
      const moodOutputs = [
        'çŠ¶æ€å¾ˆå¥½ï¼Œä¿æŒèŠ‚å¥ï¼Œæˆæœå¯æœŸï¼','ç»™è‡ªå·±ä¸€ç‚¹ç©ºé—´ï¼Œå–å£æ°´å†ä¸Šã€‚','ç¨³æ‰ç¨³æ‰“ï¼Œæ¯å¤©+1%ï¼Œä½ å·²åœ¨è·¯ä¸Šã€‚',
        'ä»Šå¤©çš„ä½ å¾ˆæ£’ï¼Œç»§ç»­ä¿æŒè€å¿ƒä¸ä¸“æ³¨ã€‚','é‡åˆ°å¡ç‚¹ä¸ä»£è¡¨é€€æ­¥ï¼Œè€Œæ˜¯ç§¯ç´¯åŠ¿èƒ½ã€‚','æ…¢ä¸€äº›ä¹Ÿå¾ˆå¥½ï¼Œå…³é”®æ˜¯æ–¹å‘æ­£ç¡®ã€‚',
        'æŠŠæ³¨æ„åŠ›æ”¾åœ¨å¯æ§é¡¹ï¼Œå¿ƒä¼šæ›´ç¨³ã€‚','è®°å½•ä½ çš„æ€è€ƒï¼Œè¿™æ˜¯ä½ æœ€å®è´µçš„äº§å‡ºã€‚','åˆ†é˜¶æ®µå®Œæˆä»»åŠ¡ï¼Œä½ ä¼šæ›´è½»æ¾ã€‚',
        'å’Œæ˜¨å¤©æ¯”å‰è¿›ä¸€ç‚¹ï¼Œå°±å€¼å¾—å¤¸å¥–ã€‚','ç§‘å­¦éœ€è¦æ—¶é—´ï¼Œä½ ä¹Ÿéœ€è¦æ—¶é—´ã€‚','ç…§é¡¾å¥½è‡ªå·±ï¼Œç§‘ç ”ä¼šæ›´é•¿ä¹…ã€‚',
        'ä½ æ­£åœ¨æˆä¸ºæ›´å¥½çš„ç ”ç©¶è€…ã€‚','è€å¿ƒæ˜¯ä½ çš„è¶…èƒ½åŠ›ã€‚','è¯·ç›¸ä¿¡é•¿æœŸä¸»ä¹‰çš„åŠ›é‡ã€‚',
        'ä¸å¿…å®Œç¾ï¼ŒæŒç»­è¿­ä»£å°±å¥½ã€‚','ä»Šå¤©ä¹Ÿå€¼å¾—è¢«è‚¯å®šã€‚','ä½ æ­£åœ¨ç´¯ç§¯å¥½è¿æ°”ã€‚',
        'ç”Ÿæ´»ä¸ç§‘ç ”éƒ½åœ¨å‘å‰ã€‚','ä½ å·²è¶³å¤ŸåŠªåŠ›ï¼Œä¸–ç•Œä¼šå›é¦ˆä½ ã€‚'
      ];
      document.getElementById('btn-mood').addEventListener('click', ()=>{ const html=`<form id=\"mood-form\"><label>ä»Šå¤©çš„æ•°æ®æ„Ÿè§‰å¦‚ä½•ï¼Ÿ</label><select name=\"d1\"><option>å¾ˆæ£’</option><option>ä¸€èˆ¬</option><option>ç³Ÿç³•</option></select><label>å®éªŒæ¨è¿›è¿›åº¦ï¼Ÿ</label><select name=\"d2\"><option>é¡ºåˆ©</option><option>å¡ä½</option></select><label>å¿ƒæƒ…çŠ¶æ€ï¼Ÿ</label><select name=\"d3\"><option>è½»æ¾</option><option>ç´§å¼ </option></select><div class=\"space\"></div><button class=\"btn\" type=\"submit\">ç”Ÿæˆè¯„è¯­</button></form>`; showModal('ç§‘ç ”å¿ƒæƒ…æµ‹è¯•', html); setTimeout(()=>{ const f=document.getElementById('mood-form'); f && f.addEventListener('submit', (e)=>{ e.preventDefault(); const d=new FormData(f); const a=d.get('d1'), b=d.get('d2'), c=d.get('d3'); let msg=''; if(a==='å¾ˆæ£’' && b==='é¡ºåˆ©') msg=moodOutputs[0]; else if(c==='ç´§å¼ ') msg=moodOutputs[1]; else msg=moodOutputs[2 + Math.floor(Math.random()*(moodOutputs.length-2))]; toast(msg); }); },0); });

      // ä»Šæ—¥æŠ½ç­¾
      const fortunes = [
        'ä»Šå¤©çš„å…³é”®å­—ï¼šç¨³å®šã€‚æŠŠæ§å˜é‡ï¼Œä½ å°±èµ¢äº†ä¸ŠåŠåœºã€‚','çµæ„Ÿæ¥è‡ªè€å¿ƒï¼Œæ–¹æ³•é«˜äºçµæ„Ÿã€‚','å¯¹ç…§ç»„çš„ç»†èŠ‚å†³å®šæˆè´¥ã€‚',
        'è®°å½•è¶Šè¯¦ç»†ï¼Œå¤ç°å®éªŒè¶Šè½»æ¾ã€‚','å…ˆéªŒè¯å…³é”®å‡è®¾ï¼Œå†æ‰©å±•ç»†èŠ‚ã€‚','ä»Šå¤©é€‚åˆåšä¸€æ¬¡å¤ç›˜ã€‚',
        'è¯•å‰‚çŠ¶æ€è‰¯å¥½ï¼Œé€‚åˆæ¨è¿›å…³é”®å®éªŒã€‚','é‡è§†è´Ÿç»“æœï¼Œå®ƒä»¬åœ¨æŒ‡è·¯ã€‚','å–„ç”¨å›¾è¡¨ï¼Œå¯è§†åŒ–å‘ç°æ›´å¤šçº¿ç´¢ã€‚',
        'æ£€æŸ¥è¯¯å·®æ¥æºï¼Œä¼šæœ‰æƒŠå–œã€‚','ä»Šå¤©é€‚åˆæ‰“ç£¨å›¾ç‰ˆã€‚','ä¼˜åŒ–ä¸€ä¸ªå‚æ•°ï¼Œçœ‹çœ‹å˜åŒ–ã€‚',
        'å†™ 5 è¡Œæ€»ç»“ï¼Œä¼šæ¸…çˆ½å¾ˆå¤šã€‚','æŠŠé—®é¢˜æ‹†è§£ï¼Œä½ å°±æ›´è‡ªç”±ã€‚','å¤‡ä»½ä¸€æ¬¡æ•°æ®ï¼Œå®‰å¿ƒåšå®éªŒã€‚',
        'ä¸åŒä¼´äº¤æµï¼Œçµæ„Ÿä¼šåŠ å€ã€‚','è¯»ä¸€æ®µæ–‡çŒ®ï¼Œå¡«ä¸Šä¸€å—æ‹¼å›¾ã€‚','æŠŠ TODO å‡ä¸€é¡¹ï¼Œç»§ç»­å‰è¿›ã€‚',
        'ä»Šå¤©æ˜¯æ”¶è·çš„ä¸€å¤©ã€‚','ä½ å·²åœ¨æ­£ç¡®çš„è·¯ä¸Šã€‚'
      ];
      document.getElementById('btn-fortune')?.addEventListener('click', ()=>{
        const t = fortunes[Math.floor(Math.random()*fortunes.length)];
        const box = document.getElementById('fortune-text');
        if(box){ box.textContent = t; }
      });

      // å°çŒ«æ¥åˆ°ä¸–ç•Œæ—¶é—´ï¼ˆè‡ª 2023-09-05 èµ·ï¼‰
      (function(){
        const el = document.getElementById('cat-age');
        if(!el) return;
        const birth = new Date('2023-09-05T00:00:00');
        function tick(){
          const msInMin = 60*1000, msInHour = 60*msInMin, msInDay = 24*msInHour;
          const now = new Date();
          const adj = new Date(now.getTime() - msInDay); // å‡å» 1 å¤©
          const daysTotal = Math.floor((adj - birth)/msInDay);
          // ç²—ç•¥æŒ‰ 365 å¤©ä¸ºä¸€å¹´è®¡ç®—å¹´ä¸ä½™å¤©
          const years = Math.floor(daysTotal / 365);
          const daysRem = daysTotal % 365;
          const todayMs = (adj - birth) - daysTotal*msInDay;
          const hours = Math.floor(todayMs / msInHour);
          const minutes = Math.floor((todayMs % msInHour) / msInMin);
          const seconds = Math.floor((todayMs % msInMin) / 1000);
          el.textContent = `${years}å¹´${daysRem}å¤©${hours}æ—¶${minutes}åˆ†${seconds}ç§’`;
        }
        tick();
        setInterval(tick, 1000);
      })();

      // äº‘å…»çŒ«ï¼šç‚¹èµï¼ˆæ’¸ä¸€ä¸‹ï¼‰è®¡æ•°
      const likeKey = (id)=> `cats:like:${id}`;
      const updateLike = (id, delta)=>{
        const el = document.getElementById(`cat-like-${id}`);
        if(!el) return;
        const cur = parseInt(localStorage.getItem(likeKey(id))||'0',10);
        const next = Math.max(0, cur + (delta||0));
        localStorage.setItem(likeKey(id), String(next));
        el.textContent = String(next);
      };
      [1,2,3].forEach(id=>{
        updateLike(id, 0);
        const btn = document.getElementById(`btn-cat-like-${id}`);
        btn && btn.addEventListener('click', ()=>{ updateLike(id, 1); toast('çŒ«çŒ«è¢«æ¸©æŸ”åœ°æ’¸äº†ä¸€ä¸‹'); });
      });

      // äº‘å…»çŒ«ï¼šæŠ•å–‚è®°å½•ï¼ˆæœ¬åœ°å­˜å‚¨æ¨¡æ‹Ÿï¼‰
      const feedStoreKey = 'cats:feeds';
      const loadFeeds = ()=>{ try{ return JSON.parse(localStorage.getItem(feedStoreKey)||'[]'); }catch{ return []; } };
      const saveFeeds = (arr)=> localStorage.setItem(feedStoreKey, JSON.stringify(arr));
      const feedList = document.getElementById('feed-list');
      const renderFeeds = ()=>{
        const feeds = loadFeeds();
        if(!feedList) return;
        feedList.innerHTML = feeds.slice(-20).reverse().map(f=>{
          const n = f.name && f.name.trim() ? f.name.trim() : 'åŒ¿åå–µå‹';
          const m = f.msg && f.msg.trim() ? `ï¼š${f.msg.trim()}` : '';
          const a = f.amount ? `ï¼ˆÂ¥${f.amount}ï¼‰` : '';
          return `<li>â¤ ${n}${m} ${a} Â· <small>${f.time}</small></li>`;
        }).join('');
      };
      renderFeeds();

      // å¿«æ·æŠ•å–‚æŒ‰é’®
      document.querySelectorAll('[data-feed]')?.forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const amount = parseInt(btn.getAttribute('data-feed')||'0',10) || 0;
          const name = (document.getElementById('feed-name')?.value||'').trim();
          const msg  = (document.getElementById('feed-msg')?.value||'').trim();
          const feeds = loadFeeds();
          feeds.push({ name, msg, amount, time: new Date().toLocaleString() });
          saveFeeds(feeds);
          renderFeeds();
          toast(`å·²æŠ•å–‚ Â¥${amount}ï¼Œè°¢è°¢ä½ çš„çˆ±å¿ƒï¼`);
        });
      });

      // ç•™è¨€æäº¤ï¼ˆä¸å«é‡‘é¢ï¼‰
      const feedForm = document.getElementById('feed-form');
      feedForm && feedForm.addEventListener('submit', (e)=>{
        e.preventDefault();
        const name = (document.getElementById('feed-name')?.value||'').trim();
        const msg  = (document.getElementById('feed-msg')?.value||'').trim();
        const feeds = loadFeeds();
        feeds.push({ name, msg, amount: 0, time: new Date().toLocaleString() });
        saveFeeds(feeds);
        renderFeeds();
        (document.getElementById('feed-msg')||{}).value='';
        toast('ç•™è¨€å·²æäº¤ï¼Œæ„Ÿè°¢æ”¯æŒï¼');
      });
    });
  </script>
</body>
</html>


